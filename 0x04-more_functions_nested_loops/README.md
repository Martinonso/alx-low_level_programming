More functions and more nested loop
